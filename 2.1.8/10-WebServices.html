<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Codeception.docs.ja : Codeception docs japanese translation">

    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/guides.css">

    <title>Codeception.docs.ja</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="container inner">
        <a id="forkme_banner" href="https://github.com/piccagliani/Codeception.docs.ja_JP">View on GitHub</a>

        <h1 id="project_title"><a href="index.html">Codeception.docs.ja</a></h1>
        <h2 id="project_tagline">Codeception docs japanese translation</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="container">
    <div class="row">
        <section id="main_content" class="col-md-9">
            <h1>Webサービスをテストする</h1>

<p>CodeceptionはWebサイトのテストと同じ方法で、Webサービスをテストすることができます。Webサービスを手動でテストすることはとても大変なので、テストを自動化することはとても良いアイディアです。CodeceptionにはSOAPとRESTに対応したモジュールが標準で備えられています。この章ではそれらのモジュールについて説明します。</p>

<p>新しくテストスイートを作成するところからはじめましょう。これは<code>bootstrap</code>コマンドでは提供されていません。テストスイートの名前は<strong>api</strong>とし、<code>ApiTester</code>クラスを使いましょう。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>php codecept.phar generate:suite api
</code></pre></div>
<p>ここにAPIのテストを記述していきます。</p>

<h2>REST</h2>

<p>REST方式のWebサービスは、HTTPの標準的なメソッドである<code>GET</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code>を介してアクセスされます。これにより、ユーザーはWebサービスからエンティティを受け取り、操作することができます。WebサービスへのアクセスにはHTTPクライアントが必要であるため、<code>PhpBrowser</code>やいずれかのフレームワーク用モジュールのセットアップを行う必要があります。Webサーバーを無視し、Webサービスを内部的にテストするために、たとえば、Symfony2で実装されたアプリケーションであれば、<code>Symfony2</code>モジュールを使用します。</p>

<p><code>api.suite.yml</code>にモジュールの設定を行います。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">class_name</span><span class="pi">:</span> <span class="s">ApiTester</span>
<span class="s">modules</span><span class="pi">:</span>
    <span class="s">enabled</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">REST</span><span class="pi">:</span>
            <span class="s">url</span><span class="pi">:</span> <span class="s">http://serviceapp/api/v1/</span>
            <span class="s">depends</span><span class="pi">:</span> <span class="s">PhpBrowser</span>
</code></pre></div>
<p>この設定に従ってRESTモジュールは<code>PhpBrowser</code>に接続するでしょう。Webサービスによっては、XMLまたはJSONレスポンスを扱うことができます。Codeceptionはどちらの形式もうまく扱いますが、もしいずれかが必要でない場合、明示的にモジュールがJSONやXMLを利用するよう指定することができます。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">class_name</span><span class="pi">:</span> <span class="s">ApiTester</span>
<span class="s">modules</span><span class="pi">:</span>
    <span class="s">enabled</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">REST</span><span class="pi">:</span>
            <span class="s">url</span><span class="pi">:</span> <span class="s">http://serviceapp/api/v1/</span>
            <span class="s">depends</span><span class="pi">:</span> <span class="s">PhpBrowser</span>
            <span class="s">part</span><span class="pi">:</span> <span class="s">Json</span>
</code></pre></div>
<p>APIテストは機能テストとして、そしてSymfony2、Laravel4、Laravel5、Zend、または他のフレームワークモジュールを使って実行することができます。そのためには設定ファイルを少し更新する必要があります：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">class_name</span><span class="pi">:</span> <span class="s">ApiTester</span>
<span class="s">modules</span><span class="pi">:</span>
    <span class="s">enabled</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">REST</span><span class="pi">:</span>
            <span class="s">url</span><span class="pi">:</span> <span class="s">/api/v1/</span>
            <span class="s">depends</span><span class="pi">:</span> <span class="s">Laravel5</span>
</code></pre></div>
<p>新しいテストスイートを設定できたら、最初のサンプルテストを作りましょう：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>php codecept.phar generate:cept api CreateUser
</code></pre></div>
<p>これを<code>CreateUserCept.php</code>と呼ぶこととします。REST APIを介したユーザーの作成をテストするために使用します。</p>

<p><code>CreateUserCept.php</code></p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApiTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">wantTo</span><span class="p">(</span><span class="s1">'create a user via API'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amHttpAuthenticated</span><span class="p">(</span><span class="s1">'service_user'</span><span class="p">,</span> <span class="s1">'123456'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">haveHttpHeader</span><span class="p">(</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="s1">'application/x-www-form-urlencoded'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">sendPOST</span><span class="p">(</span><span class="s1">'/users'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'davert'</span><span class="p">,</span> <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'davert@codeception.com'</span><span class="p">]);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseCodeIs</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseIsJson</span><span class="p">();</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseContains</span><span class="p">(</span><span class="s1">'{"result":"ok"}'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<h3>JSONレスポンスのテスト</h3>

<p>前のサンプルコードの最終行では、与えられた文字列がレスポンスに含まれることを検証しています。しかしながら、内容の形式によっては同じデータでも異なる結果を受け取ることができるので、この方法に頼るべきではありません。私たちに実際に必要なことは、レスポンスが解析できることを確認することであり、それには期待する何らかの値が含まれています。JSONの場合には<code>seeResponseContainsJson</code>メソッドを使うことができます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// matches {"result":"ok"}'
</span><span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseContainsJson</span><span class="p">([</span><span class="s1">'result'</span> <span class="o">=&gt;</span> <span class="s1">'ok'</span><span class="p">]);</span>
<span class="c1">// it can match tree-like structures as well
</span><span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseContainsJson</span><span class="p">([</span>
    <span class="s1">'user'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'davert'</span><span class="p">,</span>
            <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'davert@codeception.com'</span><span class="p">,</span>
            <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'inactive'</span>
    <span class="p">]</span>
<span class="p">]);</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>レスポンスに対して、より複雑な検証を行いたい場合があると思います。そのためには <a href="http://codeception.com/docs/06-ReusingTestCode#Helpers">ヘルパー</a>クラスに独自のメソッドを記述します。最後のJSONレスポンスにアクセスするためには、<code>REST</code>モジュールの<code>response</code>プロパティーを使用します。次に示す<code>seeResponseIsHtml</code>メソッドで説明しましょう。
（訳注：「ヘルパー」のリンク先は正しくは<a href="http://codeception.com/docs/06-ReusingTestCode#Modules-and-Helpers">こちら</a>）</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Helper</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Api</span> <span class="k">extends</span> <span class="nx">\Codeception\Module</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">seeResponseIsHtml</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModule</span><span class="p">(</span><span class="s1">'REST'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">response</span><span class="p">;</span>
        <span class="nx">\PHPUnit_Framework_Assert</span><span class="o">::</span><span class="na">assertRegex</span><span class="p">(</span><span class="s1">'~^&lt;!DOCTYPE HTML(.*?)&lt;html&gt;.*?&lt;\/html&gt;~m'</span><span class="p">,</span> <span class="nv">$response</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>同じ方法で、リクエストパラメーターや、ヘッダー情報を取得することができます。</p>

<h3>JSON構造の検証</h3>

<p>APIのテストにおいて、受け取ったデータの検証だけでなく、レスポンスの構造についても検証することはとても一般的です。レスポンスデータは通常一貫したものとしては認識されず、リクエストのたびに変わりますが、JSON/XMLの構造は同じAPIバージョンであれば同じでなければなりません。レスポンスの構造をチェックするための便利なメソッドをRESTモジュールは持っています。</p>

<p>期待するJSONレスポンスを受け取ったら、その構造を<a href="http://goessner.net/articles/JsonPath/">JSONPath</a>でチェックすることができます。XPathのように聞こえますが、JSONデータに対して動作するよう設計されています。一方で、JSONをXMLに変換してXPathを使って構造をチェックすることもできます。どちらのアプローチについても正解でかつRESTモジュール内で使用することができます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApiTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">wantTo</span><span class="p">(</span><span class="s1">'validate structure of GitHub api responses'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">sendGET</span><span class="p">(</span><span class="s1">'/users'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseIsJson</span><span class="p">();</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseJsonMatchesJsonPath</span><span class="p">(</span><span class="s1">'$[0].user.login'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseJsonMatchesXpath</span><span class="p">(</span><span class="s1">'//user/login'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>レスポンス内のフィールドの型を検証する必要がある場合、より詳細な確認が可能です。
JSONレスポンスの構造を定義する<a href="http://codeception.com/docs/modules/REST#seeResponseMatchesJsonType">seeResponseMatchesJsonType</a>アクションを使用して行うことができます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">sendGET</span><span class="p">(</span><span class="s1">'/users/1'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseIsJson</span><span class="p">();</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseMatchesJsonType</span><span class="p">([</span>
    <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="s1">'integer'</span><span class="p">,</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'string'</span><span class="p">,</span>
    <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'string:email'</span><span class="p">,</span>
    <span class="s1">'homepage'</span> <span class="o">=&gt;</span> <span class="s1">'string:url|null'</span><span class="p">,</span>
    <span class="s1">'created_at'</span> <span class="o">=&gt;</span> <span class="s1">'string:date'</span><span class="p">,</span>
    <span class="s1">'is_active'</span> <span class="o">=&gt;</span> <span class="s1">'boolean'</span>
<span class="p">]);</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>Codeceptionは、<a href="http://codeception.com/docs/modules/REST#seeResponseMatchesJsonType">容易に学習・拡張</a>できるよう、このシンプルで軽量な定義フォーマットを使用しています。</p>

<h3>XMLレスポンスのテスト</h3>

<p>REST APIがXML形式で動作する場合についても、似たような方法でデータと構造をテストすることができます。
<code>seeXmlResponseIncludes</code>メソッドはレスポンスに部分的なXMLをマッチさせる関数で、<code>seeXmlResponseMatchesXpath</code>は構造を検証するためのものです。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Codeception\Util\Xml</span> <span class="k">as</span> <span class="nx">XmlUtils</span><span class="p">;</span>

<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApiTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">wantTo</span><span class="p">(</span><span class="s1">'validate structure of GitHub api responses'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">sendGET</span><span class="p">(</span><span class="s1">'/users.xml'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeResponseIsXml</span><span class="p">();</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeXmlResponseMatchesXpath</span><span class="p">(</span><span class="s1">'//user/login'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeXmlResponseIncludes</span><span class="p">(</span><span class="nx">XmlUtils</span><span class="o">::</span><span class="na">toXml</span><span class="p">(</span>
        <span class="s1">'user'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'davert'</span><span class="p">,</span>
            <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'davert@codeception.com'</span><span class="p">,</span>
            <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'inactive'</span>
    <span class="p">]</span>
<span class="p">));</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>XML構造をきれいな方法で構築することのできるXmlUtilsクラスを使っています。<code>toXml</code>メソッドは文字列もしくは配列をとり、\DOMDocumentインスタンスを返します。もしXMLに属性が含まれていいる関係によりPHPの配列で表現できない場合は、<a href="http://codeception.com/docs/reference/XmlBuilder">XmlBuilder</a>を使ってXMLを作成することができます。次のセクションでもう少し見てみましょう。</p>

<div class="alert alert-info">
XmlBuilderのインスタンスを作成するためには、`\Codeception\Util\Xml::build()`を使ってください。
</div>

<h2>SOAP</h2>

<p>SOAP方式のWebサービスは通常、より複雑になります。<a href="http://php.net/manual/ja/soap.installation.php">SOAPサポートを有効にする</a>必要があります。XMLに関する十分な知識も必要とされます。<code>SOAP</code>モジュールは、WSDLで表されたWebサービスに接続するために、特別な形式のPOSTリクエストを利用します。Codeceptionは<code>PhpBrowser</code>やいずれかのフレームワーク用モジュールを用いてやり取りを行います。もしフレームワーク用モジュールを選択した場合、SOAPモジュールは自動的に基盤となるフレームワークに接続します。これにより、テスト実行の速度を向上させることができ、詳細なスタックトレースを提供できるようになります。</p>

<p>それでは<code>PhpBrowser</code>とともに使用する<code>SOAP</code>モジュールを設定しましょう。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">class_name</span><span class="pi">:</span> <span class="s">ApiTester</span>
<span class="s">modules</span><span class="pi">:</span>
    <span class="s">enabled</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">SOAP</span><span class="pi">:</span>
            <span class="s">depends</span><span class="pi">:</span> <span class="s">PhpBrowser</span>
            <span class="s">endpoint</span><span class="pi">:</span> <span class="s">http://serviceapp/api/v1/</span>
</code></pre></div>
<p>SOAPリクエストには認証や支払いのようなアプリケーション固有の情報を含みます。この情報はXMLリクエストの<code>&lt;soap:Header&gt;</code>要素に含まれるSOAPヘッダーによって提供されます。もしこのようなヘッダーを送信したい場合、<code>haveSoapHeader</code>メソッドを使用することができます。たとえば次のようになります。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">haveSoapHeader</span><span class="p">(</span><span class="s1">'Auth'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'Miles'</span><span class="p">,</span> <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'123456'</span><span class="p">));</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>このコードは次のXMLヘッダーを生成します。</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;soap:Header&gt;</span>
<span class="nt">&lt;Auth&gt;</span>
    <span class="nt">&lt;username&gt;</span>Miles<span class="nt">&lt;/username&gt;</span>
    <span class="nt">&lt;password&gt;</span>123456<span class="nt">&lt;/password&gt;</span>
<span class="nt">&lt;/Auth&gt;</span>
<span class="nt">&lt;/soap:Header&gt;</span>
</code></pre></div>
<p>リクエストのボディーを定義するためには<code>sendSoapRequest</code>を使用します。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">sendSoapRequest</span><span class="p">(</span><span class="s1">'CreateUser'</span><span class="p">,</span> <span class="s1">'&lt;name&gt;Miles Davis&lt;/name&gt;&lt;email&gt;miles@davis.com&lt;/email&gt;'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>この呼び出しは次のXMLに変換されます。</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;soap:Body&gt;</span>
<span class="nt">&lt;ns:CreateUser&gt;</span>
    <span class="nt">&lt;name&gt;</span>Miles Davis<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;email&gt;</span>miles@davis.com<span class="nt">&lt;/email&gt;</span>
<span class="nt">&lt;/ns:CreateUser&gt;</span>
<span class="nt">&lt;/soap:Body&gt;</span>
</code></pre></div>
<p>そして、SOAPモジュールで使用できるアサーションの一覧がこちらです。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeSoapResponseEquals</span><span class="p">(</span><span class="s1">'&lt;?xml version="1.0"?&gt;&lt;error&gt;500&lt;/error&gt;'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeSoapResponseIncludes</span><span class="p">(</span><span class="s1">'&lt;result&gt;1&lt;/result&gt;'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeSoapResponseContainsStructure</span><span class="p">(</span><span class="s1">'&lt;user&gt;&lt;name&gt;&lt;/name&gt;&lt;email&gt;&lt;/email&gt;'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeSoapResponseContainsXPath</span><span class="p">(</span><span class="s1">'//result/user/name[@id=1]'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p>もし長いXMLを記述したくない場合、<a href="http://codeception.com/docs/reference/XmlBuilder">XmlBuilder</a>クラスの利用を考えてみてください。これはjQueryのようなスタイルで複雑なXMLを構築するのに役に立ちます。
次の例では通常のXMLに替えて、<code>XmlBuilder</code>を使用しています。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Codeception\Util\Xml</span><span class="p">;</span>

<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApiTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">wantTo</span><span class="p">(</span><span class="s1">'create user'</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">haveSoapHeader</span><span class="p">(</span><span class="s1">'Session'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'token'</span> <span class="o">=&gt;</span> <span class="s1">'123456'</span><span class="p">));</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">sendSoapRequest</span><span class="p">(</span><span class="s1">'CreateUser'</span><span class="p">,</span> <span class="nx">Xml</span><span class="o">::</span><span class="na">build</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">email</span><span class="o">-&gt;</span><span class="na">val</span><span class="p">(</span><span class="s1">'miles@davis.com'</span><span class="p">));</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeSoapResponseIncludes</span><span class="p">(</span><span class="nx">Xml</span><span class="o">::</span><span class="na">build</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">result</span><span class="o">-&gt;</span><span class="na">val</span><span class="p">(</span><span class="s1">'Ok'</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<p><code>XmlBuilder</code>を使うか、プレーンなXMLを利用するかは、どちらでも構いません。<code>XmlBuilder</code>も同様にXML文字列を返します。</p>

<p>ヘルパークラスの中で<code>SOAP</code>モジュールを利用することにより、機能を拡張することができます。<code>\DOMDocument</code>としてSOAPレスポンスにアクセスするためには、<code>SOAP</code>モジュールの<code>response</code>プロパティーを使用します。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Helper</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Api</span> <span class="k">extends</span> <span class="nx">\Codeception\Module</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">seeResponseIsValidOnSchema</span><span class="p">(</span><span class="nv">$schema</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModule</span><span class="p">(</span><span class="s1">'SOAP'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">response</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">schemaValidate</span><span class="p">(</span><span class="nv">$schema</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div>
<h2>まとめ</h2>

<p>CodeceptionはさまざまなWebサービスをテストするために役立つモジュールを2つ備えています。それらを利用するために 新しく<code>api</code>スイートを作成する必要がありました。レスポンスボディーだけのテストしかできないわけではないことを覚えておいてください。<code>Db</code>モジュールを使用することで、<code>CreateUser</code>の呼び出し後にユーザーが作成されているかどうかテストすることができます。ヘルパーメソッドを利用することでRESTやSOAPを使ったテストシナリオを向上することができます。</p>

        </section>
        <nav id="nav" class="col-md-3">
            <h1>ガイド</h1>
            <div class="well">
                <ol>
                    <li><a href="01-Introduction.html">イントロダクション</a></li>
                    <li><a href="02-GettingStarted.html">はじめに</a></li>
                    <li><a href="03-AcceptanceTests.html">受け入れテスト</a></li>
                    <li><a href="04-FunctionalTests.html">機能テスト</a></li>
                    <li><a href="05-UnitTests.html">単体テスト</a></li>
                    <li><a href="06-ReusingTestCode.html">テストコードの再利用</a></li>
                    <li><a href="07-AdvancedUsage.html">高度な使用法</a></li>
                    <li><a href="08-Customization.html">カスタマイズ</a></li>
                    <li><a href="09-Data.html">データを取り扱う</a></li>
                    <li><a href="10-WebServices.html">Webサービスをテストする</a></li>
                    <li><a href="11-Codecoverage.html">コードカバレッジ</a></li>
                    <li><a href="12-ParallelExecution.html">並列実行</a></li>
                </ol>
            </div>
            <h1>目次</h1>
            <div id="toc" class="well">
            </div>
        </nav>
    </div>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="container inner">
        <p class="copyright">Codeception.docs.ja maintained by <a target="_blank" href="https://github.com/piccagliani">piccagliani</a></p>
        <p>Last updated: 2016-04-19 17:02:01 +0900, Based on <a target="_blank" href="https://github.com/Codeception/Codeception/tree/2.1.8">Codeception 2.1.8</a></p>
        <div id="contributors"></div>
    </footer>
</div>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-59804278-1");
        pageTracker._trackPageview();
    } catch(err) {}
</script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="javascripts/toc.min.js"></script>
<script src="javascripts/contributors.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#toc').toc({
            'selectors': 'h2,h3,h4',
            'container': '#main_content',
            'anchorName': function(i, heading, prefix) {
                return prefix + i;
            }
        });
    });
</script>
</body>
</html>
