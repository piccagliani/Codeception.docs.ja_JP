
<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Codeception.docs.ja : Codeception docs japanese translation">

    <link rel="stylesheet" type="text/css" media="screen" href="//piccagliani.github.io/Codeception.docs.ja_JP/stylesheets/stylesheet.css">

    <title>Codeception.docs.ja</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/piccagliani/Codeception.docs.ja_JP">View on GitHub</a>

        <h1 id="project_title">Codeception.docs.ja</h1>
        <h2 id="project_tagline">Codeception docs japanese translation</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h1>機能テスト</h1>

<p>今、私達はいくつかの受け入れテストを書いてきましたが、機能テストもほぼ同様に書けます。ひとつの大きな違いがあるだけです：機能テストは実行するのにWebサーバーを必要としないことです。</p>

<p>簡単に言えば、<code>$_REQUEST</code>や<code>$_GET</code>、<code>$_POST</code>の変数をセットし、テストからアプリケーションを実行します。このことは機能テストがより速く動作し、失敗時に詳細なスタックトレースを提供するので価値のあることでしょう。</p>

<p>Codeceptionは機能テストをサポートしている異なるフレームワークと接続出来ます:Symfony2, Laravel4, Yii2, Zend Frameworkなどです。あなたはお望みのモジュールをfunctionalスイートの設定において使用できるようにするだけです。</p>

<p>これらのフレームワークモジュールは同じインターフェイスを持っているので、フレームワークにテストが縛られることはありません。以下は機能テストのサンプルです。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FunctionalTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;Miles&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="s1">&#39;Davis&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Enter&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Hello, Miles&#39;</span><span class="p">,</span> <span class="s1">&#39;h1&#39;</span><span class="p">);</span>
<span class="c1">// $I-&gt;seeEmailIsSent() - Symfony2特有のメソッドです</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>ご覧の通り、機能テストと受け入れテストで同じテストを使うことが出来ます。</p>

<h2>落とし穴</h2>

<p>通常、受け入れテストは機能テストよりも相当な時間がかかります。しかし機能テストはひとつの環境でCodeceptionとアプリケーションを実行するため、より不安定になります。</p>

<h4>ヘッダー、クッキー、セッション</h4>

<p>機能テストの一般的な問題のひとつに、<code>headers</code>, <code>sessions</code>, <code>cookies</code>を扱うPHPメソッドの使い方があります。
ご存知のように、<code>header</code>メソッドは同じヘッダを2回以上実行するとエラーを発生させます。機能テストにおいてはアプリケーションを何回も実行するため、テスト結果にくだらないエラーがたくさん含まれてしまうでしょう。</p>

<h4>共有メモリ</h4>

<p>従来の方法とは違い、機能テストではリクエストの処理が終わった後にPHPアプリケーションを停止しません。
ひとつのメモリコンテナですべてのリクエストが実行されるので、リクエストが分離されることはありません。
したがって、<strong>もしあなたが、失敗するはずないと思っているテストが何故か失敗するときは、単一のテストで実行してみてください。</strong>
これはテストの実行中にそれぞれが分離されているかをチェックします。すべてのテストがメモリを共有して実行されていると容易に環境を壊してしまうからです。
メモリをきれいに保ち、メモリリークを避け、globalやstaticな変数をきれいにしてください。</p>

<h2>フレームワークモジュールを使う</h2>

<p>機能テストスイートは<code>tests/functional</code>ディレクトリにあります。
はじめに、スイートの設定ファイル:<code>tests/functional.suite.yml</code> にフレームワークモジュールを一つ含める必要があります。下記にもっともポピュラーなPHPフレームワークで機能テストをセットアップする簡単な手順を提供しています。</p>

<h3>Symfony2</h3>

<p>Symfony2で動作させるために、バンドルをインストールする必要も設定を変更することもありません。
テストスイートに<code>Symfony2</code>モジュールを追加する必要があるだけです。もしDoctrine2も使用するのであれば、忘れずに追加してください。</p>

<p><code>functional.suite.yml</code>の例</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Symfony2</span><span class="p-Indicator">,</span> <span class="nv">Doctrine2</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span> 
</code></pre></div>
<p>デフォルトでは、このモジュールは<code>app</code>ディレクトリのApp Kernelを検索するでしょう。</p>

<p>モジュールは追加の情報とアサーションを提供するためにSymfony Profilerを使用します。</p>

<p><a href="http://codeception.com/docs/modules/Symfony2">詳しくはリファレンス全文を見てください。</a></p>

<h3>Laravel 4</h3>

<p><a href="http://codeception.com/docs/modules/Laravel4">Laravel</a> モジュールは設定も必要なく、簡単にセットアップ出来ます。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Laravel4</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<h3>Yii2</h3>

<p>Yii2のテストは<a href="https://github.com/yiisoft/yii2-app-basic">Basic</a> と <a href="https://github.com/yiisoft/yii2-app-advanced">Advanced</a>アプリケーションテンプレートに含まれています。 始めるには、Yii2のガイドに従ってください。</p>

<h3>Yii</h3>

<p>Yiiフレームワークは、単体では機能テストを動作させる仕組みを持っていません。
なので、CodeceptionがYiiフレームワークの最初で唯一の機能テストです。
Yiiで機能テストを使用するには設定に<code>Yii1</code>モジュールを追加してください。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Yii1</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<p>先ほど議論した落とし穴を避けるために、CodeceptionはYiiエンジン上に基盤となるフックを提供しています。
それをthe installation steps in module referenceのページに従って設定してください。</p>

<h3>Zend Framework 2</h3>

<p>Zend Framework 2の内部で機能テストを実行するには<a href="http://codeception.com/docs/modules/ZF2">ZF2</a> モジュールを使用してください。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">ZF2</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<h3>Zend Framework 1.x</h3>

<p>Zend FrameworkのためのモジュールはPHPUnitの機能テストに使われるControllerTestCaseクラスに強く影響を受けています。
ブートストラップとクリーンアップに同様のアプローチが使われています。機能テストでZend Frameworkを使用する場合は<code>ZF1</code>モジュールを追加してください。</p>

<p><code>functional.suite.yml</code>の例</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">ZF1</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span> 
</code></pre></div>
<p><a href="http://codeception.com/docs/modules/ZF1">詳しくはリファレンス全文を見てください。</a></p>

<h3>Phalcon 1.x</h3>

<p><code>Phalcon1</code>モジュールは<code>\Phalcon\Mvc\Application</code>のインスタンスを返すブートストラップファイルを作成する必要があります。Phalconで機能テストを始めるには、<code>Phalcon1</code>モジュールを追加し、このブートストラップファイルにパスを通す必要があります。:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Phalcon1</span><span class="p-Indicator">,</span> <span class="nv">FunctionalHelper</span><span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Phalcon1</span>
            <span class="l-Scalar-Plain">bootstrap</span><span class="p-Indicator">:</span> <span class="s">&#39;app/config/bootstrap.php&#39;</span>
</code></pre></div>
<p><a href="http://codeception.com/docs/modules/Phalcon1">詳しくはリファレンス全文を見てください。</a></p>

<h2>機能テストを書く</h2>

<p>機能テストは<code>PhpBrowser</code>モジュールでの<a href="http://codeception.com/docs/04-AcceptanceTests">受け入れテスト</a>と同じような方法で書かれます。すべてのフレームワークモジュールと<code>PhpBrowser</code>モジュールは同じメソッドと同じエンジンを共有しています。</p>

<p>したがって、私たちは<code>amOnPage</code>メソッドでウェブページを開くことが出来ます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FunctionalTester</span><span class="p">;</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>アプリケーションのページを開くリンクをクリックします。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Logout&#39;</span><span class="p">);</span>
<span class="c1">// .nav要素のリンクをクリックする</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Logout&#39;</span><span class="p">,</span> <span class="s1">&#39;.nav&#39;</span><span class="p">);</span>
<span class="c1">// CSSセレクタによるクリック</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;a.logout&#39;</span><span class="p">);</span>
<span class="c1">// strict locatorを使用したクリック</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">([</span><span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;logout&#39;</span><span class="p">]);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>フォームの送信も同様です。：</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">submitForm</span><span class="p">(</span><span class="s1">&#39;form#login&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;123456&#39;</span><span class="p">]);</span>
<span class="c1">// 代替</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;#login input[name=name]&#39;</span><span class="p">,</span> <span class="s1">&#39;john&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;#login input[name=password]&#39;</span><span class="p">,</span> <span class="s1">&#39;123456&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Submit&#39;</span><span class="p">,</span> <span class="s1">&#39;#login&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>そしてアサーションをします。：</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Welcome, john&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Logged in successfully&#39;</span><span class="p">,</span> <span class="s1">&#39;.notice&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeCurrentUrlEquals</span><span class="p">(</span><span class="s1">&#39;/profile/john&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>フレームワークのモジュールはフレームワーク内部にアクセスするメソッドも含んでいます。例えば、<code>Laravel4</code>, <code>Phalcon1</code>, そして <code>Yii2</code>モジュールはデータベースにレコードが存在するかチェックするためのActiveRecord layerを使用する<code>seeRecord</code>メソッドを持っています。
<code>Laravel4</code>モジュールはセッションをチェックするメソッドも含んでいます。フォームのバリデーションをテストするときに<code>seeSessionHasErrors</code>メソッドは役に立つと分かるでしょう。</p>

<p>使用するモジュールの完全なリファレンスを見てください。モジュールのほとんどのメソッドはすべてに共通で、固有のメソッドは数種類です。</p>

<p>また、フレームワーク内部globalないし、<code>FunctionalHelper</code>クラスの依存関係注入コンテナの内部へもアクセス出来ます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FunctionalHelper</span> <span class="k">extends</span> <span class="nx">\Codeception\Module</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="nf">doSomethingWithMyService</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModule</span><span class="p">(</span><span class="s1">&#39;Symfony2&#39;</span><span class="p">)</span> <span class="c1">// Symfony 2モジュールの検索</span>
            <span class="o">-&gt;</span><span class="na">container</span> <span class="c1">// 現在のDI containerを取得</span>
            <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;my_service&#39;</span><span class="p">);</span> <span class="c1">// サービスにアクセス</span>

        <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Symfony2内部のカーネルにアクセスし、サービスコンテナを取得しました。私たちはテストで使用出来る<code>FunctionalTester</code>クラスのメソッドをカスタマイズして作ることも出来ます。</p>

<p>使用するモジュールに対応するリファレンスの<em>Public Properties</em>の節をチェックすることで、もっとフレームワークにアクセスする情報を得ることが出来ます。</p>

<h2>エラーレポート</h2>

<p>Codeceptionはデフォルトで<code>E_ALL &amp; ~E_STRICT &amp; ~E_DEPRECATED</code>のエラー出力レベルを使用しています。
機能テストの中で、エラーレベルをフレームワークごとの方針に変更したいと思うかもしれません。
エラー出力レベルはスイートの設定ファイルで設定する事が出来ます：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Yii1</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
<span class="l-Scalar-Plain">error_level</span><span class="p-Indicator">:</span> <span class="s">&quot;E_ALL</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">~E_STRICT</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">~E_DEPRECATED&quot;</span>
</code></pre></div>
<p><code>error_level</code>は<code>codeception.yml</code>ファイルにグローバルに定義することも出来ます。</p>

<h2>結論</h2>

<p>パワフルなフレームワークを使用しているならば、機能テストはすばらしいです。機能テストを使用する事で、フレームワークの内部状態にアクセスでき、制御する事が出来ます。
このことはテストをより短く、より速くしてくれます。フレームワークを使用しない場合ならば、機能テストを書く実用的な理由はないです。
もしここで挙げたものと違うフレームワークを使用しているならば、モジュールを作成して、コミュニティで共有してください。</p>

    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">Codeception.docs.ja maintained by <a href="https://github.com/piccagliani">piccagliani</a></p>
        <p>Last updated: 2015-02-23 16:47:13 +0900, Based on <a href="https://github.com/Codeception/Codeception/tree/2.0">Codeception</a>@4e267293bb</p>
        <div id="contributors"></div>
    </footer>
</div>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-59804278-1");
        pageTracker._trackPageview();
    } catch(err) {}
</script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//piccagliani.github.io/Codeception.docs.ja_JP/javascripts/contributors.js"></script>

</body>
</html>
