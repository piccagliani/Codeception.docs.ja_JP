
<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Codeception.docs.ja : Codeception docs japanese translation">

    <link rel="stylesheet" type="text/css" media="screen" href="//piccagliani.github.io/Codeception.docs.ja_JP/stylesheets/stylesheet.css">

    <title>Codeception.docs.ja</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/piccagliani/Codeception.docs.ja_JP">View on GitHub</a>

        <h1 id="project_title">Codeception.docs.ja</h1>
        <h2 id="project_tagline">Codeception docs japanese translation</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h1>Functional Tests</h1>

<p>Now that we&#39;ve written some acceptance tests, functional tests are almost the same, with just one major difference: functional tests don&#39;t require a web server to run tests.</p>

<p>In simple terms we set <code>$_REQUEST</code>, <code>$_GET</code> and <code>$_POST</code> variables and then we execute application from a test. This may be valuable as functional tests are faster and provide detailed stack traces on failures.</p>

<p>Codeception can connect to different web frameworks which support functional testing: Symfony2, Laravel4, Yii2, Zend Framework and others. You just need to enable desired module in your functional suite config to start.</p>

<p>Modules for all of these frameworks share the same interface, and thus your tests are not bound to any one of them. This is a sample functional test.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FunctionalTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;Miles&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="s1">&#39;Davis&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Enter&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Hello, Miles&#39;</span><span class="p">,</span> <span class="s1">&#39;h1&#39;</span><span class="p">);</span>
<span class="c1">// $I-&gt;seeEmailIsSent() - special for Symfony2</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>As you see you can use same tests for functional and acceptance testing. </p>

<h2>Pitfalls</h2>

<p>Acceptance tests are usually much slower than functional tests. But functional tests are less stable as they run Codeception and application in one environment.</p>

<h4>Headers, Cookies, Sessions</h4>

<p>One of the common issues with functional tests is usage of PHP functions that deal with <code>headers</code>, <code>sessions</code>, <code>cookies</code>.
As you know, <code>header</code> function triggers an error if it is executed more than once for the same header. In functional tests we run application multiple times, thus, we will get lots of trash errors in the result.</p>

<h4>Shared Memory</h4>

<p>In functional testing unlike the traditional way, PHP application does not stop after it finished processing a request. 
As all requests run in one memory container they are not isolated.
So <strong>if you see that your tests are mysteriously failing when they shouldn&#39;t - try to execute a single test.</strong>
This will check if tests were isolated during run. Because it&#39;s really easy to spoil environment as all tests are run in shared memory.
Keep your memory clean, avoid memory leaks and clean global and static variables.</p>

<h2>Enabling Framework Modules</h2>

<p>You have a functional testing suite in <code>tests/functional</code> dir.
To start you need to include one of the framework modules in suite config file: <code>tests/functional.suite.yml</code>. Below we provide simplified instructions for setting up functional tests with the most popular PHP frameworks.</p>

<h3>Symfony2</h3>

<p>To perform Symfony2 integrations you don&#39;t need to install any bundles or do any configuration changes.
You just need to include the <code>Symfony2</code> module into your test suite. If you also use Doctrine2, don&#39;t forget to include it too.</p>

<p>Example of <code>functional.suite.yml</code></p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Symfony2</span><span class="p-Indicator">,</span> <span class="nv">Doctrine2</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span> 
</code></pre></div>
<p>By default this module will search for App Kernel in the <code>app</code> directory.</p>

<p>The module uses the Symfony Profiler to provide additional information and assertions.</p>

<p><a href="http://codeception.com/docs/modules/Symfony2">See the full reference</a></p>

<h3>Laravel 4</h3>

<p><a href="http://codeception.com/docs/modules/Laravel4">Laravel</a> module requires no configuration and can be easily set up.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Laravel4</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<h3>Yii2</h3>

<p>Yii2 tests are included in <a href="https://github.com/yiisoft/yii2-app-basic">Basic</a> and <a href="https://github.com/yiisoft/yii2-app-advanced">Advanced</a> application templates. Follow Yii2 guides to start.</p>

<h3>Yii</h3>

<p>By itself Yii framework does not have an engine for functional testing.
So Codeception is the first and the only functional testing framework for Yii.
To use it with Yii include <code>Yii1</code> module into config.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Yii1</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<p>To avoid common pitfalls we discussed earlier, Codeception provides basic hooks over Yii engine.
Please set them up following <a href="http://codeception.com/docs/modules/Yii1">the installation steps in module reference</a>.</p>

<h3>Zend Framework 2</h3>

<p>Use <a href="http://codeception.com/docs/modules/ZF2">ZF2</a> module to run functional tests inside Zend Framework 2.</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">ZF2</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
</code></pre></div>
<h3>Zend Framework 1.x</h3>

<p>The module for Zend Framework is highly inspired by ControllerTestCase class, used for functional testing with PHPUnit. 
It follows similar approaches for bootstrapping and cleaning up. To start using Zend Framework in your functional tests, include the <code>ZF1</code> module.</p>

<p>Example of <code>functional.suite.yml</code></p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">ZF1</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span> 
</code></pre></div>
<p><a href="http://codeception.com/docs/modules/ZF1">See the full reference</a></p>

<h3>Phalcon 1.x</h3>

<p><code>Phalcon1</code> module requires creating bootstrap file which returns instance of <code>\Phalcon\Mvc\Application</code>. To start writing functional tests with Phalcon support you should enable <code>Phalcon1</code> module and provide path to this bootstrap file:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Phalcon1</span><span class="p-Indicator">,</span> <span class="nv">FunctionalHelper</span><span class="p-Indicator">]</span>
    <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Phalcon1</span>
            <span class="l-Scalar-Plain">bootstrap</span><span class="p-Indicator">:</span> <span class="s">&#39;app/config/bootstrap.php&#39;</span>
</code></pre></div>
<p><a href="http://codeception.com/docs/modules/Phalcon1">See the full reference</a></p>

<h2>Writing Functional Tests</h2>

<p>Functional tests are written in the same manner as <a href="http://codeception.com/docs/04-AcceptanceTests">Acceptance Tests</a> with <code>PhpBrowser</code> module enabled. All framework modules and <code>PhpBrowser</code> module share the same methods and the same engine.</p>

<p>Therefore we can open a web page with <code>amOnPage</code> command.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FunctionalTester</span><span class="p">;</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>We can click links to open web pages of application.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Logout&#39;</span><span class="p">);</span>
<span class="c1">// click link inside .nav element</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Logout&#39;</span><span class="p">,</span> <span class="s1">&#39;.nav&#39;</span><span class="p">);</span>
<span class="c1">// click by CSS</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;a.logout&#39;</span><span class="p">);</span>
<span class="c1">// click with strict locator</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">([</span><span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;logout&#39;</span><span class="p">]);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>We can submit forms as well:</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">submitForm</span><span class="p">(</span><span class="s1">&#39;form#login&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;123456&#39;</span><span class="p">]);</span>
<span class="c1">// alternatively</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;#login input[name=name]&#39;</span><span class="p">,</span> <span class="s1">&#39;john&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;#login input[name=password]&#39;</span><span class="p">,</span> <span class="s1">&#39;123456&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Submit&#39;</span><span class="p">,</span> <span class="s1">&#39;#login&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>And do assertions:</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Welcome, john&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Logged in successfully&#39;</span><span class="p">,</span> <span class="s1">&#39;.notice&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeCurrentUrlEquals</span><span class="p">(</span><span class="s1">&#39;/profile/john&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Framework modules also contain additional methods to access framework internals. For instance, <code>Laravel4</code>, <code>Phalcon1</code>, and <code>Yii2</code> modules have <code>seeRecord</code> method which uses ActiveRecord layer to check that record exists in database.
<code>Laravel4</code> module also contains methods to do additional session checks. You may find <code>seeSessionHasErrors</code> useful when you test form validations.</p>

<p>Take a look at the complete reference for module you are using. Most of its methods are common for all modules but some of them are unique.</p>

<p>Also you can access framework globals inside a test or access Depenency Injection containers inside <code>FunctionalHelper</code> class.</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FunctionalHelper</span> <span class="k">extends</span> <span class="nx">\Codeception\Module</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="nf">doSomethingWithMyService</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getModule</span><span class="p">(</span><span class="s1">&#39;Symfony2&#39;</span><span class="p">)</span> <span class="c1">// lookup for Symfony 2 module</span>
            <span class="o">-&gt;</span><span class="na">container</span> <span class="c1">// get current DI container</span>
            <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;my_service&#39;</span><span class="p">);</span> <span class="c1">// access a service</span>

        <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>We accessed Symfony2 internal kernel and took a service out of container. We also created custom method in <code>FunctionalTester</code> class which can be used in tests.</p>

<p>You can learn more about accessing framework you use by checking <em>Public Properties</em> section in the reference for the corresponding module. </p>

<h2>Error Reporting</h2>

<p>By default Codeception uses <code>E_ALL &amp; ~E_STRICT &amp; ~E_DEPRECATED</code> error reporting level. 
In functional tests you might want to change this level depending on framework&#39;s error policy.
The error reporting level can be set in the suite configuraion file:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">FunctionalTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">Yii1</span><span class="p-Indicator">,</span> <span class="nv">TestHelper</span><span class="p-Indicator">]</span>
<span class="l-Scalar-Plain">error_level</span><span class="p-Indicator">:</span> <span class="s">&quot;E_ALL</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">~E_STRICT</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">~E_DEPRECATED&quot;</span>
</code></pre></div>
<p><code>error_level</code> can be set globally in <code>codeception.yml</code> file.</p>

<h2>Conclusion
<p>Functional tests are great if you are using powerful frameworks. By using functional tests you can access and manipulate their internal state. 
This makes your tests shorter and faster. In other cases, if you don&#39;t use frameworks there is no practical reason to write functional tests.
If you are using a framework other than the ones listed here, create a module for it and share it with community.</p>

    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">Codeception.docs.ja maintained by <a href="https://github.com/piccagliani">piccagliani</a></p>
        <p>Last updated: 2015-02-18 14:06:18 +0900, Based on <a href="https://github.com/Codeception/Codeception/tree/2.0">Codeception</a>@4e267293bb</p>
    </footer>
</div>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-59804278-1");
        pageTracker._trackPageview();
    } catch(err) {}
</script>


</body>
</html>
