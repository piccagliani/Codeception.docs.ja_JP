<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Codeception.docs.ja : Codeception docs japanese translation">

    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/guides.css">

    <title>Codeception.docs.ja</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="container inner">
        <a id="forkme_banner" href="https://github.com/piccagliani/Codeception.docs.ja_JP">View on GitHub</a>

        <h1 id="project_title"><a href="index.html">Codeception.docs.ja</a></h1>
        <h2 id="project_tagline">Codeception docs japanese translation</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/piccagliani/Codeception.docs.ja_JP/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="container">
    <div class="row">
        <section id="main_content" class="col-md-9">
            <h1>高度な使用法</h1>

<p>この章ではあなたのテストのエクスペリエンスを向上させ、プロジェクトをより良い組織に保つためのいくつかのテクニックとオプションについて取り上げます。</p>

<h2>Cestクラス</h2>

<p>もしCept形式に対して、クラスのような構造を持たせたい場合、プレーンなPHPの替わりにCest形式を利用することができます。
Cest形式はとても単純でCept形式のシナリオと完全な互換性があります。これはつまり、テストが非常に長くなり分割したいと感じた場合、簡単にクラスに移動することができることを意味します。</p>

<p>次のコマンドによりCestを作成することができます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar generate:cest suitename CestName
</code></pre></div>
<p>生成されたファイルは次のようになります。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">BasicCest</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">_before</span><span class="p">(</span><span class="nx">\AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">_after</span><span class="p">(</span><span class="nx">\AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// tests</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">tryToTest</span><span class="p">(</span><span class="nx">\AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span> 
    <span class="p">{</span>    
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><strong>それぞれのpublicなメソッド（「_」で始まるものを除く）はテストとして実行され</strong>、最初の引数としてアクタークラスを、2つ目の引数して<code>$scenario</code>変数を受け取ります。</p>

<p><code>_before</code>と<code>_after</code>メソッドはそのクラスのテストに対する共通のセットアップとティアダウンのために使用することができます。このことが、類似の処理をヘルパークラスのみに依存するCept形式と比較して、Cest形式をより柔軟にしています。</p>

<p>ご覧のように、<code>tryToTest</code>メソッドにアクターオブジェクトを渡しています。このオブジェクトを使ってこれまでにやってきた方法でシナリオを描くことができます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">BasicCest</span>
<span class="p">{</span>
    <span class="c1">// test</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">checkLogin</span><span class="p">(</span><span class="nx">\AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">wantTo</span><span class="p">(</span><span class="s1">&#39;log in to site&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;john&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;coltrane&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Enter&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Hello, John&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">seeInCurrentUrl</span><span class="p">(</span><span class="s1">&#39;/account&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>このように、Cestクラスは<code>\Codeception\TestCase\Test</code>や<code>PHPUnit_Framework_TestCase</code>といった親クラスを持ちません。意図的にそうしています。これにより、子クラスで使用することができる共通の振る舞いや処理を伴ってクラスを拡張することができます。ただし、それらのメソッドはテストとして実行されないよう<code>protected</code>なメソッドとして定義することを忘れないでください。</p>

<p>また、テストが<code>error</code>となったり失敗した時に呼ばれる<code>_failed</code>メソッドについてもCestクラスに定義することができます。</p>

<h3>Before/Afterアノテーション</h3>

<p><code>@before</code>と<code>@after</code>アノテーションを使ってテストの実行フローをコントロールすることができます。共通のアクションをprotectedな（テストでない）メソッドに移動し、アノテーションを記述することによってテストの前後でそれらを呼び出すことができます。<code>@before</code>や<code>@after</code>アノテーションを複数利用することによって、複数のメソッドを呼び出すことが可能です。メソッドは上から下の順で呼び出されます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">ModeratorCest</span> <span class="p">{</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="s1">&#39;miles&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;Password&#39;</span><span class="p">,</span> <span class="s1">&#39;davis&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @before login</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">banUser</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/users/charlie-parker&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Ban&#39;</span><span class="p">,</span> <span class="s1">&#39;.button&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Ban&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @before login</span>
<span class="sd">     * @before cleanup</span>
<span class="sd">     * @after logout</span>
<span class="sd">     * @after close</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addUser</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/users/charlie-parker&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Ban&#39;</span><span class="p">,</span> <span class="s1">&#39;.button&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Ban&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><code>@before</code>と<code>@after</code>アノテーションはインクルードされた関数に対しても使えます。ただし、1つのメソッドに対して同じ種類のアノテーションを複数記述することはできません。1つのメソッドに対して、1つの<code>@before</code>と1つの<code>@after</code>アノテーションのみですd - one method can have only one <code>@before</code> and only one <code>@after</code> annotation.</p>

<h3>Dependsアノテーション</h3>

<p><code>@depends</code>アノテーションを使って現在のテストが事前にどのテストにパスしているべきか、指定することができます。もし事前のテストが失敗したら、対象のテストはスキップされます。
依存しているテストのメソッド名をアノテーションに記述してください。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">ModeratorCest</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// logs moderator in</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @depends login</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">banUser</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// bans user</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>ヒント：<code>@depends</code>アノテーションは<code>@before</code>アノテーションと組み合わせることができます。</p>

<h2>インタラクティブ・コンソール</h2>

<p>インタラクティブ・コンソールはCodeceptionのコマンドをテストで実行する前に試すために追加されました。</p>

<p><img src="http://img267.imageshack.us/img267/204/003nk.png" alt="コンソール"></p>

<p>次のコマンドでコンソールを起動することができます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar console suitename
</code></pre></div>
<p>これで、アクタークラスに対応したすべてのコマンドを実行することができ、結果をすぐに確認できます。特に、<code>WebDriver</code>モジュールと使用する場合に便利です。Selenuimとブラウザーの起動にはいつも長い時間がかかります。ところが、コンソールを使って別のセレクタ、異なるコマンドを試すことで、実行された際に確実にパスするテストを書くことができます。</p>

<p>特別なヒント：コンソールとSeleniumを使ってあなたがウェブページを上手に操作できるか上司に見せましょう。この手順を自動化し、プロジェクトに受け入れテストを導入することを説得しやすくなるでしょう。</p>

<h2>異なるフォルダーからテストを実行する</h2>

<p>もしCodeceptionを使ったプロジェクトが複数あったとしても、すべてのテストを1つの<code>codecept.phar</code>で実行することができます。
異なるディレクトリーのCodeceptionを実行するために、<code>bootstrap</code>を除くすべてのコマンドに<code>-c</code>オプションが用意されています。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar run -c ~/projects/ecommerce/
<span class="nv">$ </span>php codecept.phar run -c ~/projects/drupal/
<span class="nv">$ </span>php codecept.phar generate:cept acceptance CreateArticle -c ~/projects/drupal/
</code></pre></div>
<p>現在の場所と異なるディレクトリー内にプロジェクトを作成するには、パラメータとしてパスを指定するだけです。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar bootstrap ~/projects/drupal/
</code></pre></div>
<p>基本的に<code>-c</code>オプションにはパスを指定しますが、使用する設定ファイルを指定することもできます。従って、テストスイートに対して複数の<code>codeception.yml</code>を持つことができます。さまざまな環境や設定を指定するためにこのオプションを使用することができます。特定の設定ファイルを使ってテストを実行するためには、<code>-c</code>オプションにファイル名を渡してください。</p>

<h2>グループ</h2>

<p>テストをグルーピングして実行する方法はいくつかあります。特定のディレクトリを指定して実行することもできます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar run tests/acceptance/admin
</code></pre></div>
<p>また、特定の（もしくは複数の）グループを指定して実行することもできます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar run -g admin -g editor
</code></pre></div>
<p>このケースでは<code>admin</code>と<code>editor</code>グループに属すすべてのテストが実行されます。グループの概念はPHPUnitから取り入れたもので、従来のPHPUnitと同様の振る舞いをします。Ceptをグループに追加するには、<code>scenario</code>変数を使います。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$scenario</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">);</span>
<span class="nv">$scenario</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="nv">$scenario</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">))</span>
<span class="c1">// or</span>
<span class="nv">$scenario</span><span class="o">-&gt;</span><span class="na">groups</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;editor&#39;</span><span class="p">))</span>

<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AcceptanceTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">wantToTest</span><span class="p">(</span><span class="s1">&#39;admin area&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Test形式とCest形式のテストでは、テストをグループに追加するために<code>@group</code>アノテーションを使います。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * @group admin</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">testAdminUser</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">role</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Cestクラスでも同じアノテーションを使用できます。</p>

<h3>グループファイル</h3>

<p>グループはグローバルまたはテストスイートの設定ファイルで定義できます。
グループに含まれるテストは、配列形式で指定するか、テストの一覧が含まれるファイルパスを指定します。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">groups</span><span class="p-Indicator">:</span>
  <span class="c1"># add 2 tests to db group</span>
  <span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">tests/unit/PersistTest.php</span><span class="p-Indicator">,</span> <span class="nv">tests/unit/DataTest.php</span><span class="p-Indicator">]</span>

  <span class="c1"># add list of tests to slow group</span>
  <span class="l-Scalar-Plain">slow</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tests/_data/slow</span>  
</code></pre></div>
<p>たとえば、最も遅いテストの一覧ファイルを作成し、それらのグループ内で実行することができます。
グループファイルは各行にテスト名が記述されたプレーンテキストファイルです。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">tests/unit/DbTest.php
tests/unit/UserTest.php:create
tests/unit/UserTest.php:update
</code></pre></div>
<p>グループファイルは手動で作成することもできますし、サードパーティ製のアプリケーションによって生成することもできます。
たとえば、XMLレポートから遅いテストを抽出してグループファイルを更新するスクリプトを記述することができるでしょう。</p>

<p>1つの定義で複数のグループファイルをロードするような、パターンについても指定することもできます。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">groups</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">p*</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tests/_data/p*</span>
</code></pre></div>
<p>これは、<code>tests/_data</code>内の<code>p*</code>パターンに一致するすべてのファイルをグループとしてロードします。</p>

<h2>リファクタリング</h2>

<p>テストが成長していくにつれ、共通の変数や振る舞いを共有するためのリファクタリングが必要になります。古典的な例は、テストスイートのあらゆる箇所で呼び出される<code>login</code>アクションです。これは、1度だけ記述しすべてのテストで使用するようにするのが賢明です。</p>

<p>このようなケースにおいてPHPクラスの中にそれらのメソッドを定義するというのは明白です。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">TestCommons</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$username</span> <span class="o">=</span> <span class="s1">&#39;john&#39;</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$password</span> <span class="o">=</span> <span class="s1">&#39;coltrane&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">logMeIn</span><span class="p">(</span><span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$username</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$password</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="s1">&#39;Enter&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>そして、このファイルを<code>_bootstrap.php</code>ファイルから読み込みます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// bootstrap</span>
<span class="k">require_once</span> <span class="s1">&#39;/path/to/test/commons/TestCommons.php&#39;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>シナリオの中で使います。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AcceptanceTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nx">TestCommons</span><span class="o">::</span><span class="na">logMeIn</span><span class="p">(</span><span class="nv">$I</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>もしアイディアを得られたら、テストコードを構造化するためのいくつかのビルトイン機能について学びましょう。Codeceptionにおける<code>PageObject</code>と<code>StepObject</code>パターンの実装について学びます。</p>

<h2>ページオブジェクト</h2>

<p><a href="http://code.google.com/p/selenium/wiki/PageObjects">ページオブジェクトパターン</a>はテスト自動化エンジニアの間では広く使われています。ページオブジェクトパターンでは、ウェブページをクラスとして、ページ上のDOM要素をプロパティとして表現し、いくつかの基本的なインタラクションをメソッドして持ちます。
ページオブジェクトはテストの柔軟なアーキテクチャを作りこむ際にとても重要です。複雑なCSSやXPathロケーターをテストにハードコードするのではなく、ページオブジェクトクラスに移動してください。</p>

<p>Codeceptionは次のコマンドでページオブジェクトクラスを生成することができます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar generate:pageobject Login
</code></pre></div>
<p>これにより、<code>tests/_pages</code>内に<code>LoginPage</code>クラスが作成されます。基本のページオブジェクトはいくつかのスタブを持った空クラス以上の何ものでもありません。
空クラスであることは、ページオブジェクトがページを表現するUIロケーターとともに準備されることを期待しており、それらのロケーターはページで利用されるでしょう。
ロケーターはpublicでstaticなプロパティとして定義されます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">LoginPage</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="nv">$usernameField</span> <span class="o">=</span> <span class="s1">&#39;#mainForm #username&#39;</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$passwordField</span> <span class="o">=</span> <span class="s1">&#39;#mainForm input[name=password]&#39;</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$loginButton</span> <span class="o">=</span> <span class="s1">&#39;#mainForm input[type=submit]&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>そして、ページオブジェクトはテストの中で次のように使用されます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AcceptanceTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">wantTo</span><span class="p">(</span><span class="s1">&#39;login to site&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="nx">LoginPage</span><span class="o">::</span><span class="nv">$URL</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="nx">LoginPage</span><span class="o">::</span><span class="nv">$usernameField</span><span class="p">,</span> <span class="s1">&#39;bill evans&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="nx">LoginPage</span><span class="o">::</span><span class="nv">$passwordField</span><span class="p">,</span> <span class="s1">&#39;debby&#39;</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nx">LoginPage</span><span class="o">::</span><span class="nv">$loginButton</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">see</span><span class="p">(</span><span class="s1">&#39;Welcome, bill&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>このとおり、あなたはログインページのマークアップを気兼ねなく変更することができ、このページを対象とするすべてのテストに含まれるロケーターはLoginPageクラスのプロパティに従って更新されるでしょう。</p>

<p>しかし、ここでさらに先に進みましょう。ページオブジェクトの概念は、ページのインタラクションを行うメソッドについてもページオブジェクトクラスに含まれるべき、と規定しています。
先ほど作成した<code>LoginPage</code>クラスではこれを行うことはできません。なぜなら、このクラスはすべてのテストスイートからアクセス可能なので、どのアクタークラスをインタラクションに使用するのかわからないためです。そのため、別のページオブジェクトを作成する必要があります。この例では、ページオブジェクトを使用するテストスイートを明示します。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar generate:pageobject acceptance UserLogin
</code></pre></div>
<p><em>先ほど作成したLoginクラスと名前が衝突しないよう、UserLoginクラスとします</em></p>

<p>作成された<code>UserLoginPage</code>クラスは1つの違いをのぞき、ほぼ先ほどのLoginPageクラスと同じように見えます。今度は渡されたアクタークラスのインスタンスを保持しています。AcceptanceTesterに<code>AcceptanceTester</code>プロパティを介してアクセスできます。では、このクラスに<code>login</code>メソッドを定義しましょう。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserLoginPage</span>
<span class="p">{</span>
    <span class="c1">// include url of current page</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$URL</span> <span class="o">=</span> <span class="s1">&#39;/login&#39;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @var AcceptanceTester</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$AcceptanceTester</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">AcceptanceTester</span> <span class="o">=</span> <span class="nv">$I</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">of</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="k">static</span><span class="p">(</span><span class="nv">$I</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$I</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">AcceptanceTester</span><span class="p">;</span>

        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$URL</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="nx">LoginPage</span><span class="o">::</span><span class="nv">$usernameField</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="nx">LoginPage</span><span class="o">::</span><span class="nv">$passwordField</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nx">LoginPage</span><span class="o">::</span><span class="nv">$loginButton</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>    
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>そして、これがテストの中でページオブジェクトを使用する方法の例です。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AcceptanceTester</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nx">UserLoginPage</span><span class="o">::</span><span class="na">of</span><span class="p">(</span><span class="nv">$I</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="s1">&#39;bill evans&#39;</span><span class="p">,</span> <span class="s1">&#39;debby&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>おそらく、<code>UserLoginPage</code>と<code>LoginPage</code>とは同じ役割を担っているようなので、マージすべきかもしれません。しかし、<code>LoginPage</code>が機能テストと受け入れテストの両方で使える一方、<code>UserLoginPage</code>は<code>AcceptanceTester</code>でのみ使うことができます。ですので、グローバルなページオブジェクトを利用するかテストスイート単位のページオブジェクトを使用するかはあなた次第です。もし機能テストと受け入れテストとに多くの共通点がある場合は、グローバルなページオブジェクトにロケーターを格納し、ページオブジェクトの振る舞いの部分については代替としてステップオブジェクトを使ってください。</p>

<h2>ステップオブジェクト</h2>

<p>ステップオブジェクトパターンはBDDフレームワークに由来します。ステップオブジェクトは異なるテストで広く使われるであろう共通のアクション群を含みます。
前述の<code>login</code>メソッドはそのような共通アクションの良い例です。似たようなアクションであるリソースの作成・更新・削除についてもステップオブジェくトに移動するべきです。ステップオブジェクトを作成し、どのようなものか見てみましょう。</p>

<p><code>Member</code>ステップクラスを作成しましょう。ジェネレーターが含まれるメソッドを聞いてくるので、<code>login</code>を追加しましょう。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar generate:stepobject acceptance Member
</code></pre></div>
<p>アクション名を入力するよう求められますが、これはオプションです。はじめに「login」を入力し、エンターキーを押します。すべての必要なアクションを指定した後、ステップオブジェクトの作成に進むには空行のままにしておきます。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar generate:stepobject acceptance Member
Add action to StepObject class <span class="o">(</span>ENTER to <span class="nb">exit</span><span class="o">)</span>: login
Add action to StepObject class <span class="o">(</span>ENTER to <span class="nb">exit</span><span class="o">)</span>:
StepObject was created in &lt;you path&gt;/tests/acceptance/_steps/MemberSteps.php
</code></pre></div>
<p>これで次のような<code>tests/acceptance/_steps/MemberSteps.php</code>クラスが作成されます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">AcceptanceTester</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MemberSteps</span> <span class="k">extends</span> <span class="nx">\AcceptanceTester</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$I</span> <span class="o">=</span> <span class="nv">$this</span><span class="p">;</span>

    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>ご覧のようにとてもシンプルなクラスです。<code>AcceptanceTester</code>クラスを継承しているので、<code>AcceptanceTester</code>のすべてのメソッドとプロパティがこのクラス内で利用可能です。</p>

<p><code>login</code>メソッドは次のように実装できるでしょう。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">AcceptanceTester</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MemberSteps</span> <span class="k">extends</span> <span class="nx">\AcceptanceTester</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$I</span> <span class="o">=</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">amOnPage</span><span class="p">(</span><span class="nx">\LoginPage</span><span class="o">::</span><span class="nv">$URL</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="nx">\LoginPage</span><span class="o">::</span><span class="nv">$usernameField</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">fillField</span><span class="p">(</span><span class="nx">\LoginPage</span><span class="o">::</span><span class="nv">$passwordField</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
        <span class="nv">$I</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nx">\LoginPage</span><span class="o">::</span><span class="nv">$loginButton</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>テストでは<code>AcceptanceTester</code>の代わりに<code>MemberSteps</code>クラスをインスタンス化することでステップオブジェクトを使用することができます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$I</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AcceptanceTester\MemberSteps</span><span class="p">(</span><span class="nv">$scenario</span><span class="p">);</span>
<span class="nv">$I</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="s1">&#39;bill evans&#39;</span><span class="p">,</span> <span class="s1">&#39;debby&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>このように、ステップオブジェクトクラスは従来のページオブジェクトと比較してより単純で可読性に優れています。
ステップオブジェクトの代替として<code>AcceptanceHelper</code>クラスを利用することができます。ヘルパーの内部では<code>$I</code>オブジェクトそのものにアクセスできないため、ヘルパーは新しいアクションを実装するために使い、ステップオブジェクトは共通のシナリオを統合するために使うのが良いでしょう。</p>

<h2>環境</h2>
<p>別の設定を使ってテストを実行する必要がある場合、別の設定環境を定義することができます。
最も典型的なユースケースとしては、種類の違うブラウザーで受け入れテストを実行する場合や、異なるデータベースエンジンを利用してテストを実行する場合です。</p>

<p>ブラウザーのケースについて、環境をどう使うか、実際にやってみましょう。</p>

<p><code>acceptance.suite.yml</code>に新しく行を追加する必要があります。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">class_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AcceptanceTester</span>
<span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">WebDriver</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">AcceptanceHelper</span>
    <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&#39;http://127.0.0.1:8000/&#39;</span>
            <span class="l-Scalar-Plain">browser</span><span class="p-Indicator">:</span> <span class="s">&#39;firefox&#39;</span>

<span class="l-Scalar-Plain">env</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">phantom</span><span class="p-Indicator">:</span>
         <span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">browser</span><span class="p-Indicator">:</span> <span class="s">&#39;phantomjs&#39;</span>

    <span class="l-Scalar-Plain">chrome</span><span class="p-Indicator">:</span>
         <span class="l-Scalar-Plain">modules</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">WebDriver</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">browser</span><span class="p-Indicator">:</span> <span class="s">&#39;chrome&#39;</span>

    <span class="l-Scalar-Plain">firefox</span><span class="p-Indicator">:</span>
        <span class="c1"># nothing changed</span>
</code></pre></div>
<p>最初はこのような設定の構造は汚く見えるかもしれませんが、これが最もクリーンな方法です。
基本的に、ルートの<code>env</code>配下に異なる環境を定義し、名前を付け（<code>phantom</code>とか<code>chrome</code>など）、そしてすでに設定されている任意のパラメータを再定義します。</p>

<p>テスト実行する際に、<code>--env</code>オプションによって容易にこれらの設定を切り替えることができます。PhantomJSのみのテストを実行するには、次のように<code>--env phantom</code>を渡します。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar run acceptance --env phantom
</code></pre></div>
<p>3つのブラウザーすべてのテストを実行するには、単にすべての環境を列挙します。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>php codecept.phar run acceptance --env phantom --env chrome --env firefox
</code></pre></div>
<p>異なるブラウザーごとに3回テストが実行されるでしょう。</p>

<p>環境に応じて、実行されるべきテストを選択することができます。
たとえば、いくつかのテストはFirefoxでのみ実行され、他のいくつかはChromeのみで実行されるようにする必要があるかもしれません。</p>

<p>Test形式、Cest形式のテストでは、<code>@env</code>アノテーションを使って求められる環境を指定することができます。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserCest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * This test will be executed only in &#39;firefox&#39; and &#39;phantom&#39; environments</span>
<span class="sd">     *</span>
<span class="sd">     * @env firefox</span>
<span class="sd">     * @env phantom</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">webkitOnlyTest</span><span class="p">(</span><span class="nx">AcceptanceTester</span> <span class="nv">$I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// I do something</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Cept形式では<code>$scenario-&gt;env()</code>を使ってください。</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$scenario</span><span class="o">-&gt;</span><span class="na">env</span><span class="p">(</span><span class="s1">&#39;firefox&#39;</span><span class="p">);</span>
<span class="nv">$scenario</span><span class="o">-&gt;</span><span class="na">env</span><span class="p">(</span><span class="s1">&#39;phantom&#39;</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="nv">$scenario</span><span class="o">-&gt;</span><span class="na">env</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;phantom&#39;</span><span class="p">,</span> <span class="s1">&#39;firefox&#39;</span><span class="p">));</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>この方法で、どのブラウザーでどのテストを行うか、簡単にコントロールすることができます。</p>

<h2>まとめ</h2>

<p>Codeceptionは一見シンプルなフレームワークのように見えますが、強力なテストを、単一のAPIを使って、それらをリファクタリングし、そしてインタラクティブ・コンソールを使ってより速く、構築することができます。CodeceptionのテストはグループやCestクラスを使って容易に整理することができ、ロケーターはページオブジェクトに、そして共通のステップはステップオブジェクトに統合することができます。</p>

<p>おそらく単体のフレームワークとしては機能が多すぎるかもしれません。しかし、それにもかかわらずCodeceptionはKISSの原則に従っています。Codeceptionは簡単に始めることができ、習得が容易で、楽に拡張することができるのです。</p>

        </section>
        <nav id="nav" class="col-md-3">
            <div class="well">
                <ol>
                    <li><a href="01-Introduction.html">イントロダクション</a></li>
                    <li><a href="02-GettingStarted.html">はじめに</a></li>
                    <li><a href="03-ModulesAndHelpers.html">モジュールとヘルパー</a></li>
                    <li><a href="04-AcceptanceTests.html">受け入れテスト</a></li>
                    <li><a href="05-FunctionalTests.html">機能テスト</a></li>
                    <li><a href="06-UnitTests.html">単体テスト</a></li>
                    <li><a href="07-AdvancedUsage.html">高度な使用法</a></li>
                    <li><a href="08-Customization.html">カスタマイズ</a></li>
                    <li><a href="09-Data.html">データを取り扱う</a></li>
                    <li><a href="10-WebServices.html">Webサービスをテストする</a></li>
                    <li><a href="11-Codecoverage.html">コードカバレッジ</a></li>
                    <li><a href="12-ParallelExecution.html">並列実行</a></li>
                </ol>
            </div>
        </nav>
    </div>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="container inner">
        <p class="copyright">Codeception.docs.ja maintained by <a target="_blank" href="https://github.com/piccagliani">piccagliani</a></p>
        <p>Last updated: 2015-06-01 10:28:35 +0900, Based on <a target="_blank" href="https://github.com/Codeception/Codeception/releases/tag/2.0.13">Codeception 2.0.13</a></p>
        <div id="contributors"></div>
    </footer>
</div>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-59804278-1");
        pageTracker._trackPageview();
    } catch(err) {}
</script>
<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="javascripts/contributors.js"></script>
</body>
</html>
